---
const token = import.meta.env.BLOG_ADMIN_TOKEN;
const endpoint = `/api/blog-admin-stats?token=${token ?? ''}`;
---
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Blog Stats (Admin)</title>
    <meta name="robots" content="noindex" />
  </head>
  <body class="bg-neutral-900 text-neutral-100 font-sans">
    <main class="mx-auto max-w-4xl p-6">
      <h1 class="text-3xl mb-4">Live Blog Metrics</h1>
      <p class="text-sm mb-6">Requires valid admin token. Data updates on refresh.</p>
      <div id="stats" class="space-y-4"></div>
    </main>
    <script type="module">
      const el = document.getElementById('stats');
      async function load(){
        const res = await fetch('{endpoint}');
        if(!res.ok){
          el.textContent = 'Unauthorized or unavailable.';
          return;
        }
        const json = await res.json();
        el.innerHTML = Object.entries(json.stats).map(([slug, d]) => `\n<div class='border border-neutral-700 rounded p-4'>\n  <h2 class='text-xl mb-2'>${slug}</h2>\n  <p class='text-sm'>Views: ${d.views}</p>\n  <p class='text-sm'>Avg Time: ${d.avgTimeSeconds}s</p>\n  <p class='text-sm'>Max Scroll: ${(d.maxScrollPct*100).toFixed(0)}%</p>\n</div>`).join('');
      }
      load();
    </script>
  </body>
</html>
