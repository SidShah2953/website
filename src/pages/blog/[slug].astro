---
import { getCollection } from 'astro:content';
import Layout from '@/layouts/Layout.astro';
import { estimateReadingTime } from '@/utils/estimateReadingTime';

const toTitleCase = (str: string) => str.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ');

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts
    .filter(p => !p.data.isDraft)
    .map(p => ({ params: { slug: p.slug }, props: { entry: p } }));
}

const { entry } = Astro.props;
const stats = estimateReadingTime(entry.body);
const { Content } = await entry.render();
---
<Layout title={entry.data.title + ' | Siddhant Shah'} description={entry.data.description}>
  <link
    slot="head"
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"
    integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ"
    crossorigin="anonymous"
  />
  <script slot="head" defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "e709a605fa1c4a3895e2987e5a9ca9c6"}'></script>
  <script slot="head" data-goatcounter="https://siddhants.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
  <main class="flex flex-col gap-16">
    <article class="post glass-card p-8 md:p-12 relative overflow-hidden">
      <!-- Decorative gradient -->
      <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-finance-cyan/10 to-finance-purple/10 blur-3xl rounded-full"></div>
      
      <header class="flex w-full flex-col gap-6 relative z-10">
        <div class="flex flex-col gap-4">
          <h1 class="text-4xl md:text-5xl font-bold gradient-text leading-tight">{entry.data.title}</h1>
          <div class="flex flex-wrap gap-4 text-sm text-neutral-400 items-center">
            <time datetime={entry.data.publishedAt.toISOString()} class="flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              {entry.data.publishedAt.toDateString()}
            </time>
            <span class="flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              {stats.minutes} min read
            </span>
            {entry.data.tags.length > 0 && (
              <span class="flex gap-2 flex-wrap">
                {entry.data.tags.map(tag => (
                  <a href={`/blog?tag=${encodeURIComponent(tag)}`} 
                     class="px-3 py-1 rounded-lg bg-finance-cyan/10 text-finance-cyan border border-finance-cyan/30 hover:bg-finance-cyan/20 hover:border-finance-cyan/50 transition-all text-xs font-medium">
                    {toTitleCase(tag)}
                  </a>
                ))}
              </span>
            )}
          </div>
        </div>
      </header>
      <div class="relative z-10 mt-8">
        <Content />
      </div>
    </article>
  </main>
</Layout>
