---
import { getCollection } from 'astro:content';
import Layout from '@/layouts/Layout.astro';
import { estimateReadingTime } from '@/utils/estimateReadingTime';

const toTitleCase = (str: string) => str.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ');

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts
    .filter(p => !p.data.isDraft)
    .map(p => ({ params: { slug: p.slug }, props: { entry: p } }));
}

const { entry } = Astro.props;
const stats = estimateReadingTime(entry.body);
const { Content } = await entry.render();
---
<Layout title={entry.data.title + ' | Siddhant Shah'} description={entry.data.description}>
  <link
    slot="head"
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"
    integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ"
    crossorigin="anonymous"
  />
  <script slot="head" defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "e709a605fa1c4a3895e2987e5a9ca9c6"}'></script>
  <script slot="head" type="module" src="/blog-engagement.js"></script>
  <main class="flex flex-col gap-20">
    <article class="post">
      <header class="flex w-full flex-col gap-8">
        <div class="flex flex-col gap-4">
          <h1 class="text-3xl text-neutral-100">{entry.data.title}</h1>
          <div class="flex flex-row gap-4 text-sm text-neutral-400">
            <time datetime={entry.data.publishedAt.toISOString()}>{entry.data.publishedAt.toDateString()}</time>
            <span>{stats.minutes} min read</span>
            {entry.data.tags.length > 0 && (
              <span class="flex gap-2">
                {entry.data.tags.map(tag => (
                  <a href={`/blog?tag=${encodeURIComponent(tag)}`} class="hover:text-neutral-100">#{toTitleCase(tag)}</a>
                ))}
              </span>
            )}
          </div>
        </div>
      </header>
      <Content />
    </article>
  </main>
</Layout>
