---
import { getCollection } from 'astro:content';
import BlogLayout from '@/layouts/BlogLayout.astro';
import { estimateReadingTime } from '@/utils/estimateReadingTime';
import '@/styles/tailwind.css';
import '@/styles/post.css';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts
    .filter(p => !p.data.isDraft)
    .map(p => ({ params: { slug: p.slug }, props: { entry: p } }));
}

const { entry } = Astro.props;
const stats = estimateReadingTime(entry.body);
const canonical = entry.data.canonical || `https://${import.meta.env.PUBLIC_BLOG_HOST || 'blog.example.com'}/blog/${entry.slug}/`;
const { Content } = await entry.render();
---
<BlogLayout title={entry.data.title} description={entry.data.description} canonical={canonical}>
  <article class="post prose prose-invert max-w-none">
    <header class="mb-6">
      <h1 class="text-4xl font-bold mb-2">{entry.data.title}</h1>
      <div class="flex flex-row gap-4 text-sm text-neutral-400">
        <time datetime={entry.data.publishedAt.toISOString()}>{entry.data.publishedAt.toDateString()}</time>
        <span>{stats.minutes} min read</span>
        {entry.data.tags.length > 0 && <span>{entry.data.tags.join(', ')}</span>}
      </div>
    </header>
    <Content />
  </article>
</BlogLayout>
