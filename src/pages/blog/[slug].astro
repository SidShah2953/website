---
import { getCollection } from 'astro:content';
import Layout from '@/layouts/Layout.astro';
import ContentPage from '@/components/ContentPage.astro';
import { estimateReadingTime } from '@/utils/estimateReadingTime';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts
    .filter(p => !p.data.isDraft)
    .map(p => ({ params: { slug: p.slug }, props: { entry: p } }));
}

const { entry } = Astro.props;
const stats = estimateReadingTime(entry.body);
const { Content } = await entry.render();
---
<Layout title={entry.data.title + ' | Siddhant Shah'} description={entry.data.description}>
  <link
    slot="head"
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"
    integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ"
    crossorigin="anonymous"
  />
  <script slot="head" defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "e709a605fa1c4a3895e2987e5a9ca9c6"}'></script>
  {import.meta.env.PROD && <script slot="head" data-goatcounter="https://siddhants.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>}

  <ContentPage type="blog" entry={entry} Content={Content} readingTime={stats.minutes} />
</Layout>
