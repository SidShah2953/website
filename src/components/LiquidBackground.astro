---
// Liquid Glass 3D Background with animated mesh
---
<div class="fixed inset-0 z-0 overflow-hidden bg-dark-bg">
  <!-- Gradient mesh background -->
  <div class="absolute inset-0 bg-gradient-mesh opacity-30"></div>
  
  <!-- Animated grid -->
  <canvas id="grid-canvas" class="absolute inset-0 w-full h-full opacity-20"></canvas>
  
  <!-- Floating glass orbs -->
  <div class="absolute top-1/4 left-1/4 w-96 h-96 rounded-full bg-finance-blue/8 blur-3xl animate-float"></div>
  <div class="absolute bottom-1/4 right-1/4 w-96 h-96 rounded-full bg-finance-cyan/8 blur-3xl animate-float" style="animation-delay: 3s;"></div>
  
  <!-- Subtle noise texture overlay -->
  <div class="absolute inset-0 opacity-[0.015] mix-blend-overlay"
       style="background-image: url('data:image/svg+xml,%3Csvg viewBox=&apos;0 0 256 256&apos; xmlns=&apos;http://www.w3.org/2000/svg&apos;%3E%3Cfilter id=&apos;noise&apos;%3E%3CfeTurbulence type=&apos;fractalNoise&apos; baseFrequency=&apos;0.9&apos; numOctaves=&apos;4&apos; /%3E%3C/filter%3E%3Crect width=&apos;100%25&apos; height=&apos;100%25&apos; filter=&apos;url(%23noise)&apos; /%3E%3C/svg%3E');"></div>
</div>

<script>
  const canvas = document.getElementById('grid-canvas') as HTMLCanvasElement;
  if (canvas) {
    const ctx = canvas.getContext('2d');
    if (ctx) {
      let animationId: number;
      let time = 0;

      const resize = () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      };

      const drawGrid = () => {
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      const candleWidth = 60;
      const candleSpacing = 100;
      const baseY = canvas.height * 0.6;
      
      // Seed for consistent randomness per candle position
      const seededRandom = (seed: number) => {
        const x = Math.sin(seed) * 10000;
        return x - Math.floor(x);
      };
      
      // Draw candlestick pattern
      ctx.lineWidth = 1;
      
      for (let x = 0; x < canvas.width + candleSpacing; x += candleSpacing) {
        const seed = Math.floor(x / candleSpacing);
        const randomOffset = seededRandom(seed) * 120 - 60;
        const randomHeight = seededRandom(seed + 1000) * 80 + 40;
        const randomWickTop = seededRandom(seed + 2000) * 50 + 20;
        const randomWickBottom = seededRandom(seed + 3000) * 50 + 20;
        
        const offset = Math.sin((x + time) * 0.002) * 100 + randomOffset;
        const y = baseY + offset;
        
        // Candlestick body height with variation
        const bodyHeight = randomHeight + Math.sin((x + time) * 0.0015) * 45;
        const wickTop = y - bodyHeight - randomWickTop;
        const wickBottom = y + randomWickBottom;
        
        const isGreen = seededRandom(seed + 4000) > 0.5;
        
        // Draw wick (thin line)
        ctx.strokeStyle = isGreen ? 'rgba(6, 182, 212, 0.3)' : 'rgba(59, 130, 246, 0.3)';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(x, wickTop);
        ctx.lineTo(x, wickBottom);
        ctx.stroke();
        
        // Draw candlestick body with subtle shadow
        ctx.fillStyle = isGreen ? 'rgba(6, 182, 212, 0.15)' : 'rgba(59, 130, 246, 0.15)';
        ctx.strokeStyle = isGreen ? 'rgba(6, 182, 212, 0.4)' : 'rgba(59, 130, 246, 0.4)';
        ctx.lineWidth = 2;
        ctx.fillRect(x - candleWidth / 2, y - bodyHeight, candleWidth, bodyHeight);
        ctx.strokeRect(x - candleWidth / 2, y - bodyHeight, candleWidth, bodyHeight);
      }
      
      // Draw multiple trend lines for depth
      for (let layer = 0; layer < 2; layer++) {
        ctx.beginPath();
        const layerOffset = layer * 30;
        ctx.strokeStyle = `rgba(6, 182, 212, ${0.15 - layer * 0.05})`;
        ctx.lineWidth = 2 - layer * 0.5;
        for (let x = 0; x < canvas.width; x += 8) {
          const y = baseY + layerOffset + 
                    Math.sin((x + time) * 0.0015) * 70 + 
                    Math.cos((x + time) * 0.001) * 40 +
                    Math.sin((x + time) * 0.003) * 20;
          if (x === 0) {
            ctx.moveTo(x, y);
          } else {
            ctx.lineTo(x, y);
          }
        }
        ctx.stroke();
      }
      
        time += 16;
        animationId = requestAnimationFrame(drawGrid);
      };

      resize();
      window.addEventListener('resize', resize);
      drawGrid();

      // Cleanup
      document.addEventListener('astro:before-swap', () => {
        cancelAnimationFrame(animationId);
        window.removeEventListener('resize', resize);
      });
    }
  }
</script>
